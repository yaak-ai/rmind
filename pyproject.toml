[project]
name = "cargpt"
version = "0.1.0"
description = ""
authors = [{ name = "ML yaak team", email = "ml@yaak.ai" }]
readme = "README.md"
requires-python = ">=3.12, <3.13"
dependencies = [
  "torch",
  "tensordict>=0.6.2",
  "rbyte[jpeg,yaak]==0.10.1",
  "pytorch-lightning>=2.4.0",
  "torchvision>=0.20.0",
  "torchaudio>=2.4.0",
  "xformers==0.0.28.post2",
  "einops>=0.8.0",
  "hydra-core>=1.3.2",
  "loguru>=0.7.2",
  "numpy<2.0.0",
  "omegaconf>=2.3.0",
  "typing-extensions>=4.12.2",
  "more-itertools>=10.4.0",
  "jaxtyping>=0.2.33",
  "torchinfo>=1.8.0",
  "pydantic>=2.10.3",
  "polars>=1.16.0",
  "optree>=0.13.1",
  "orjson>=3.10.12",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.metadata]
allow-direct-references = true

[project.optional-dependencies]
train = ["torchmetrics>=1.4.1", "transformers>=4.44.2", "wandb>=0.17.7"]
predict = ["funcy>=2.0", "rerun-sdk>=0.20.3", "wandb>=0.17.7"]
lint = ["deptry>=0.19.1", "pyright>=1.1.377", "ruff>=0.6.2"]
dev = [
  "devtools>=0.12.2",
  "ipdb>=0.13.13",
  "ipython>=8.26.0",
  "ipython-autoimport>=0.5",
  "lovely-tensors>=0.1.16",
  "pre-commit>=3.8.0",
  "pudb>=2024.1.2",
  "pyfzf>=0.3.1",
  "pyright>=1.1.377",
  "pytest-pudb>=0.7.0",
]
notebook = [
  "euporie>=2.8.2",
  "hvplot>=0.10.0",
  "jupyterlab>=4.2.4",
  "jupyterlab-vim>=4.1.3",
  "matplotlib>=3.9.2",
  "torchshow>=0.5.1",
]
test = ["beartype == 0.19.0rc0", "pytest>=8.3.2"]


[tool.basedpyright]
typeCheckingMode = "standard"
enableTypeIgnoreComments = true
reportMissingTypeStubs = "none"
reportAny = "none"
reportIgnoreCommentWithoutRule = "error"

venvPath = "."
venv = ".venv"
include = ["src/"]
exclude = ["wandb/"]

[tool.ruff]
preview = true
unsafe-fixes = true

[tool.ruff.lint]
select = ["ALL"]
fixable = ["ALL"]
ignore = [
  "A001",
  "A002",
  "ANN",
  "C901",
  "COM812",
  "CPY",
  "D",
  "E203",
  "E501",
  "EXE",
  "F722",
  "F821",
  "FA",
  "FBT003",
  "FIX",
  "ISC001",
  "N",
  "NPY002",
  "PD",
  "PGH",
  "PLR",
  "S101",
  "S311",
  "SIM118",
  "SLF",
  "TC001",
  "TD",
  "PLC2701",
  "DOC",     # TODO: enable
]

[tool.ruff.format]
skip-magic-trailing-comma = true

[tool.ruff.lint.isort]
known-third-party = ["wandb"]
split-on-trailing-comma = false

# [tool.pytest.ini_options]
# addopts = "--jaxtyping-packages=foo,bar.baz,beartype.beartype"

[tool.deptry]
ignore = ["DEP002"]

[tool.deptry.per_rule_ignores]
DEP001 = ["cargpt", "rerun"]
DEP003 = ["cargpt"]

[tool.deptry.package_module_name_map]
hydra-core = "hydra"
pytorch-lightning = [
  "pytorch_lightning",
  "lightning_fabric",
  "lightning_utilities",
]

[dependency-groups]
dev = ["wat-inspector>=0.4.3"]
