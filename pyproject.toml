[project]
name = "cargpt"
version = "0.1.0"
description = ""
authors = [{ name = "ML yaak team", email = "ml@yaak.ai"}]
readme = "README.md"
requires-python = ">=3.12"
dependencies = [
  "torch >= 2.4.0",
  "pytorch-lightning >= 2.3.3",
  "torchvision >= 0.19.0",
  "torchaudio >= 2.4.0",
  "tensordict @ git+https://github.com/pytorch/tensordict.git",
  "xformers == 0.0.27.post2",
  "einops >= 0.8.0",
  "hydra-core >= 1.3.2",
  "loguru >= 0.7.2",
  "jaxtyping",
  "more-itertools",
  "torchinfo",
  "numpy < 2.0.0",
  "typing-extensions",
  "omegaconf >= 2.3.0",
  "rbyte",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.metadata]
allow-direct-references = true

[project.optional-dependencies]
train = [
  "rbyte",
  "torchmetrics",
  "transformers",
  "polars",
  "wandb",
]

predict = [
  "rbyte",
  "rerun-sdk >= 0.16.1",
  "funcy",
  "wandb",
]

lint = [
  "pyright",
  "ruff",
  "deptry",
]

dev = [
  "ipdb", 
  "ipython", 
  "pudb", 
  "ipython-autoimport", 
  "pyfzf", 
  "pyright", 
  "lovely-tensors", 
  "pre-commit", 
  "devtools", 
  "pytest-pudb", 
]

notebook = [
  "jupyterlab",
  "jupyterlab-vim",
  "hvplot",
  "euporie",
  "torchshow",
  "matplotlib",
]

test = [
  "pytest",
  "beartype == 0.19.0rc0",
]

[tool.pyright]
typeCheckingMode = "strict"
deprecateTypingAliases = true
enableExperimentalFeatures = true

reportAttributeAccessIssue = "warning"
reportCallInDefaultInitializer = "error"
reportImplicitOverride = "warning"
reportImportCycles = "error"
reportIncompatibleMethodOverride = "warning"
reportMissingParameterType = "none"
reportMissingSuperCall = "warning"
reportMissingTypeStubs = "none"
reportPrivateUsage = "none"
reportPrivateImportUsage = "none"
reportPropertyTypeMismatch = "error"
reportShadowedImports = "error"
reportUninitializedInstanceVariable = "none"
reportUnknownArgumentType = "none"
reportUnknownLambdaType = "none"
reportUnknownMemberType = "none"
reportUnknownParameterType = "none"
reportUnknownVariableType = "none"
reportUnnecessaryTypeIgnoreComment = "warning"
reportUnusedCallResult = "error"
reportUntypedClassDecorator = "none"

exclude = ['wandb/**', 'cargpt/models/gato.py', '**.ipynb']
ignore = ['wandb/**', 'cargpt/models/gato.py', '**.ipynb']

[tool.ruff]
preview = true
unsafe-fixes = true

[tool.ruff.lint]
select = ["ALL"]
fixable = ["ALL"]
ignore = [
  "A001",
  "A002",
  "ANN",
  "C901",
  "COM812",
  "CPY",
  "D",
  "E203",
  "E501",
  "EXE",
  "F722",
  "F821",
  "FA",
  "FBT003",
  "FIX",
  "ISC001",
  "N",
  "NPY002",
  "PD",
  "PGH",
  "PLR",
  "S101",
  "S311",
  "SIM118",
  "SLF",
  "TCH001",
  "TD",
  "PLC2701",
]

[tool.ruff.format]
skip-magic-trailing-comma = true

[tool.ruff.lint.isort]
known-third-party = ["wandb"]
split-on-trailing-comma = false

[tool.deptry.per_rule_ignores]
DEP001 = ["rerun"]
DEP002 = ["torchaudio"]
DEP004 = ["funcy", "polars", "tqdm", "yaak_datasets", "torchmetrics"]

[tool.pytest.ini_options]
addopts = "--jaxtyping-packages=foo,bar.baz,beartype.beartype"

[tool.uv.sources]
rbyte = { url = "https://github.com/yaak-ai/rbyte/releases/latest/download/rbyte-0.1.0-py3-none-any.whl" }
